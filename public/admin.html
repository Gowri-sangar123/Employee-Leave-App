<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#2563eb',
              danger: '#dc2626',
              success: '#16a34a',
            },
          },
        },
      }
    </script>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="max-w-6xl mx-auto mt-10 p-4">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Admin Dashboard</h2>
        <button
          onclick="logout()"
          class="bg-danger hover:bg-red-700 text-white px-4 py-2 rounded"
        >
          Logout
        </button>
      </div>

      <!-- User Management -->
      <section class="bg-white shadow-md rounded mb-6">
        <div class="bg-primary text-white px-4 py-2 rounded-t">
          User Management
        </div>
        <div class="p-4 overflow-x-auto">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-200 text-sm">
                <th class="px-3 py-2 text-left">Name</th>
                <th class="px-3 py-2">Email</th>
                <th class="px-3 py-2">Role</th>
              </tr>
            </thead>
            <tbody id="userList" class="text-sm"></tbody>
          </table>
        </div>
      </section>

      <!-- Leave Types -->
      <section class="bg-white shadow-md rounded">
        <div
          class="bg-primary text-white px-4 py-2 rounded-t flex justify-between items-center"
        >
          <span>Leave Types</span>
          <button
            onclick="addLeaveType()"
            class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-sm"
          >
            + Add Leave Type
          </button>
        </div>
        <div class="p-4 overflow-x-auto">
          <table class="w-full table-auto">
            <thead>
              <tr class="bg-gray-200 text-sm">
                <th class="px-3 py-2 text-left">Leave Type</th>
                <th class="px-3 py-2">Default Balance</th>
                <th class="px-3 py-2">Actions</th>
              </tr>
            </thead>
            <tbody id="leaveTypeList" class="text-sm"></tbody>
          </table>
        </div>
      </section>
    </div>

    <script>
      const token = localStorage.getItem('token')
      if (!token) window.location = 'login.html'

      async function fetchUsers() {
        try {
          const res = await fetch('http://localhost:5000/api/admin/users', {
            headers: { Authorization: 'Bearer ' + token },
          })
          const users = await res.json()
          document.getElementById('userList').innerHTML = users
            .map(
              (u) => `
              <tr>
                <td class="px-3 py-2">${u.name}</td>
                <td class="px-3 py-2 text-center">${u.email}</td>
                <td class="px-3 py-2 text-center">
                  <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">${u.role}</span>
                </td>
              </tr>`
            )
            .join('')
        } catch (err) {
          alert('Failed to fetch users.')
        }
      }

      async function fetchLeaveTypes() {
        try {
          const res = await fetch(
            'http://localhost:5000/api/admin/leave-types',
            {
              headers: { Authorization: 'Bearer ' + token },
            }
          )
          const types = await res.json()
          document.getElementById('leaveTypeList').innerHTML = types
            .map(
              (t) => `
              <tr>
                <td class="px-3 py-2">${t.name}</td>
                <td class="px-3 py-2 text-center">${t.defaultBalance}</td>
                <td class="px-3 py-2 text-center">
                  <button class="bg-yellow-500 text-white text-xs px-2 py-1 rounded mr-2" onclick="editLeaveType('${t._id}')">Edit</button>
                  <button class="bg-danger text-white text-xs px-2 py-1 rounded" onclick="deleteLeaveType('${t._id}')">Delete</button>
                </td>
              </tr>`
            )
            .join('')
        } catch (err) {
          alert('Failed to fetch leave types.')
        }
      }

      function logout() {
        localStorage.clear()
        window.location = 'login.html'
      }

      function addLeaveType() {
        const type = prompt('Enter new leave type:')
        const balance = prompt('Enter default balance:')
        if (type && balance) {
          fetch('http://localhost:5000/api/admin/leave-types', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: 'Bearer ' + token,
            },
            body: JSON.stringify({ name: type, defaultBalance: balance }),
          })
            .then(() => fetchLeaveTypes())
            .catch(() => alert('Failed to add leave type.'))
        }
      }

      function editLeaveType(id) {
        const type = prompt('New leave type name:')
        const balance = prompt('New default balance:')
        if (type && balance) {
          fetch(`http://localhost:5000/api/admin/leave-types/${id}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              Authorization: 'Bearer ' + token,
            },
            body: JSON.stringify({ name: type, defaultBalance: balance }),
          })
            .then(() => fetchLeaveTypes())
            .catch(() => alert('Failed to update leave type.'))
        }
      }

      function deleteLeaveType(id) {
        if (confirm('Are you sure you want to delete this leave type?')) {
          fetch(`http://localhost:5000/api/admin/leave-types/${id}`, {
            method: 'DELETE',
            headers: { Authorization: 'Bearer ' + token },
          })
            .then(() => fetchLeaveTypes())
            .catch(() => alert('Failed to delete leave type.'))
        }
      }

      // Init
      fetchUsers()
      fetchLeaveTypes()
    </script>
  </body>
</html>
