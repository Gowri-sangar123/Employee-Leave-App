<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Register - Leave Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="w-full max-w-md bg-white p-6 rounded shadow-md">
      <h3 class="text-2xl font-bold text-center text-blue-600 mb-6">
        Register
      </h3>
      <form id="registerForm" class="space-y-4">
        <input
          type="text"
          id="name"
          placeholder="Name"
          required
          autofocus
          class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <input
          type="email"
          id="email"
          placeholder="Email"
          required
          class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <div class="relative">
          <input
            type="password"
            id="password"
            placeholder="Password"
            required
            class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <button
            type="button"
            onclick="togglePassword()"
            class="absolute right-3 top-2 text-sm text-blue-600"
          >
            Show
          </button>
        </div>
        <select
          id="role"
          required
          class="w-full border border-gray-300 rounded px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="employee">Employee</option>
          <option value="manager">Manager</option>
          <option value="admin">Admin</option>
        </select>
        <button
          id="submitBtn"
          type="submit"
          class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition font-medium"
        >
          Register
        </button>
      </form>
      <p class="text-center mt-4 text-sm" id="message"></p>
    </div>

    <script>
      function togglePassword() {
        const pwd = document.getElementById('password')
        pwd.type = pwd.type === 'password' ? 'text' : 'password'
      }

      document
        .getElementById('registerForm')
        .addEventListener('submit', async function (e) {
          e.preventDefault()
          const submitBtn = document.getElementById('submitBtn')
          const messageEl = document.getElementById('message')

          // Disable the button
          submitBtn.disabled = true
          submitBtn.textContent = 'Registering...'

          try {
            const res = await fetch('http://localhost:5000/api/auth/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                role: document.getElementById('role').value,
              }),
            })

            const data = await res.json()

            if (data.token) {
              localStorage.setItem('token', data.token)
              localStorage.setItem('role', data.role)
              localStorage.setItem('employeeName', data.name)
              messageEl.textContent = 'Registration successful!'
              messageEl.className = 'text-green-600 text-center'
              setTimeout(() => {
                window.location.href =
                  data.role === 'manager'
                    ? 'manager.html'
                    : data.role === 'admin'
                    ? 'admin.html'
                    : 'employee.html'
              }, 1000)
            } else {
              messageEl.textContent = data.message || 'Registration failed'
              messageEl.className = 'text-red-600 text-center'
            }
          } catch (err) {
            messageEl.textContent = 'Server error. Please try again.'
            messageEl.className = 'text-red-600 text-center'
          } finally {
            submitBtn.disabled = false
            submitBtn.textContent = 'Register'
          }
        })
    </script>
  </body>
</html>
